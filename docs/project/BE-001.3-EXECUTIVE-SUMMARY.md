# BE-001.3 Distributed Locks - Executive Summary (1-Pager)

> **For**: PM, UI Team Lead, Stakeholders  
> **Meeting**: Monday, November 18, 2025 @ 10:00 AM  
> **Read Time**: 3 minutes  
> **Full Details**: `BE-001.3-DECISION-CHECKLIST.md` (725 lines)

---

## üö® Why This Meeting is Critical

**UI Team Validation Result** (Nov 16, 2025):

- ‚úÖ BE-001.1 (Connection) + BE-001.2 (Presence) = **Perfect**
- ‚ùå **CRITICAL GAP**: No editor locking ‚Üí **High risk of data loss**

**Real-World Impact**:

```
Dr. Smith opens operation report, edits diagnosis
Nurse Jane opens same report, edits diagnosis
Both click Save ‚Üí Last save wins ‚Üí One person's work lost
```

**Without locking**: Cannot deploy to production (HIPAA compliance risk).

---

## ‚úÖ Already Decided (No Discussion Needed)

| Decision                | Approved Option                         | Rationale                               |
| ----------------------- | --------------------------------------- | --------------------------------------- |
| **Viewer Permission**   | Option A: Upstream auth (JWT/ACLs)      | Separation of concerns, simpler, Week 3 |
| **Resource ID Pattern** | `type:uuid:child` (auto-append `:main`) | Backward compatible, consistent         |
| **Max Editors**         | ALWAYS 1 per child resource             | Immutable rule, prevents conflicts      |
| **Max Viewers**         | Unlimited (configurable if needed)      | Maximize collaboration                  |

---

## ‚ùì 8 Decisions Needed in Meeting (30 minutes)

### **Quick Decision Matrix**

| #     | Decision            | Recommended                       | Alternative              | Impact      |
| ----- | ------------------- | --------------------------------- | ------------------------ | ----------- |
| **1** | Lock upgrade flow   | ‚ùå Deny + notify (Week 3)         | ‚è∞ Queue (Week 4)        | UX          |
| **2** | Disconnect handling | ‚è≥ 30s grace period (Week 3)      | ‚ö° Immediate (Week 3)    | Forgiveness |
| **3** | Tab lock limits     | üî¢ 5 tabs max (Week 3)            | ‚àû Unlimited (Week 3)     | Fairness    |
| **4** | Admin takeover      | üîî Request + 30s timeout (Week 4) | ‚ö° Immediate (Week 3)    | Urgency     |
| **5** | Lock TTL            | ‚è∞ 5 minutes (Week 3)             | ‚öôÔ∏è Configurable (Week 3) | Balance     |
| **6** | Viewer limits       | ‚öôÔ∏è Per resource type (Week 3)     | ‚àû Unlimited (Week 3)     | Security    |
| **7** | Heartbeat interval  | üïê 60 seconds (Week 3)            | üïê 30s / 120s            | Network     |
| **8** | Backward compat     | ‚úÖ Auto-append `:main` (Week 3)   | ‚ùå Require 3-part        | UI impact   |

---

### **Decision 1: Lock Upgrade Flow** ‚è≥ **2 minutes**

**Scenario**: Viewer wants to edit, but lock already held.

**Options**:

- **A)** ‚ùå Deny + show notification "Dr. Smith editing, expires in 4 min" (Week 3) ‚Üê **Recommended**
- **B)** ‚è∞ Add to queue, notify when available (Week 4)
- **C)** üîî "Request Lock" button ‚Üí Push notification to editor (Week 4)

**Question**: Simple deny for Phase 1, or build queue/request system?

---

### **Decision 2: Disconnect Handling** ‚è≥ **2 minutes**

**Scenario**: Lock holder's laptop dies / network fails.

**Options**:

- **A)** ‚ö° Release immediately (Week 3)
- **B)** ‚è≥ 30-second grace period (Week 3) ‚Üê **Recommended** (survives WiFi glitches)
- **C)** üó≥Ô∏è Prompt viewers "Claim now or wait?" (Week 4)

**Question**: Forgive temporary disconnects (30s) or release immediately?

---

### **Decision 3: Tab Lock Limits** ‚è≥ **2 minutes**

**Scenario**: User editing multiple tabs in same document.

**Options**:

- **A)** ‚àû Unlimited (Week 3)
- **B)** üî¢ Max 5 tabs per user (Week 3) ‚Üê **Recommended** (prevents hoarding)
- **C)** ‚öôÔ∏è Configurable per resource type (Week 3-4)

**Question**: Limit concurrent locks to prevent hoarding?

---

### **Decision 4: Admin Takeover** ‚è≥ **3 minutes**

**Scenario**: Surgeon needs lock urgently, nurse holds it.

**Options**:

- **A)** ‚ö° Immediate force takeover (Week 3)
- **B)** üîî Request approval, force after 30s timeout (Week 4) ‚Üê **Recommended** (polite)
- **C)** ‚ùå No force takeover, wait for TTL (Week 3)

**Question**: Healthcare emergencies need immediate takeover, or 30s polite request OK?

---

### **Decision 5: Lock TTL** ‚è≥ **1 minute**

**Options**: 2 min | **5 min** ‚Üê Recommended | 10 min | Configurable per type

**Question**: Is 5 minutes enough for typical edits, or need longer for complex reports?

---

### **Decision 6: Viewer Limits** ‚è≥ **2 minutes**

**Options**:

- **A)** ‚àû Unlimited (Week 3)
- **B)** üî¢ Global limit (100 viewers, Week 3)
- **C)** ‚öôÔ∏è Configurable per resource type (Week 3) ‚Üê **Recommended** (security for sensitive docs)

**Question**: HIPAA compliance: Should sensitive operation reports limit viewers?

---

### **Decision 7: Heartbeat Interval** ‚è≥ **1 minute**

**Options**: 30s (high traffic) | **60s** ‚Üê Recommended (balanced) | 120s (low traffic)

**Question**: Is 1 heartbeat/minute acceptable network overhead?

---

### **Decision 8: Backward Compatibility** ‚è≥ **1 minute**

**Question**: UI sends `document:123` (2 parts) ‚Üí Backend normalizes to `document:123:main`?

**Impact**: UI must handle 3-part IDs in responses, but can keep sending 2-part.

---

## üìã Meeting Outcomes (To Be Filled)

### Decisions

1. Lock Upgrade: ****\_\_\_\_**** (A/B/C)
2. Disconnect: ****\_\_\_\_**** (A/B/C)
3. Tab Limits: ****\_\_\_\_**** (A/B/C)
4. Admin Takeover: ****\_\_\_\_**** (A/B/C)
5. Lock TTL: ****\_\_\_\_**** (2/5/10/Config)
6. Viewer Limits: ****\_\_\_\_**** (A/B/C)
7. Heartbeat: ****\_\_\_\_**** (30/60/120s)
8. Backward Compat: ****\_\_\_\_**** (Yes/No)

### Timeline Confirmation

- **Phase 1 Start**: Monday, Nov 18, 14:00 (if approved today)
- **Phase 1 Delivery**: Monday, Nov 25 (9 days)
- **Phase 2 Delivery**: Monday, Dec 2 (16 days total)

### Blockers

- ***

---

## üéØ What Happens After Meeting

### If All Approved Today (Best Case)

**This Week** (Nov 18-22):

- Monday PM: Setup Redis Docker Compose + ioredis integration
- Tuesday-Wednesday: Implement RedisLockService (acquire/release/renew)
- Thursday-Friday: WebSocket lock events + BDD tests (6 scenarios)

**Next Week** (Nov 25-29):

- Monday: Phase 1 delivery + UI Team review
- Tuesday-Friday: Phase 2 (hierarchical locking, 4 BDD scenarios)

### If Decisions Delayed (Worst Case)

- Every day delayed = 1-day slip in delivery
- Week 3-4 at risk ‚Üí Blocks UI Team Phase 2 development

---

## üìû Pre-Meeting Actions

### PM

- [ ] Review decision summary (above)
- [ ] Prepare timeline constraints

### UI Team Lead

- [ ] Review UI impact (3-part resource IDs, lock events)
- [ ] Confirm viewer permission model (Option A approved)

### Backend Team

- [ ] Prepare demo of Redis lock prototype (if time permits)
- [ ] Have implementation plan ready

### Healthcare Consultant

- [ ] Review admin takeover requirement (emergency scenarios)
- [ ] Confirm HIPAA compliance for viewer limits

---

## üìé Supporting Documents

- **This Summary**: `BE-001.3-EXECUTIVE-SUMMARY.md` (1-pager)
- **Full Checklist**: `BE-001.3-DECISION-CHECKLIST.md` (725 lines, all details)
- **Technical Spec**: `BE-001.3-LOCK-SPECIFICATION.md` (750 lines, implementation)
- **UI Feedback**: Message dated November 16, 2025
- **Backend Response**: `BACKEND_RESPONSE_TO_UI_FEEDBACK.md`

---

## ‚úÖ Success Criteria (Definition of Done)

**Phase 1** (Week 3 - Nov 25):

- [ ] Single-editor enforcement working (auto-downgrade second editor)
- [ ] Lock TTL + heartbeat renewal working
- [ ] Disconnect handling (grace period or immediate, per decision)
- [ ] 6 BDD scenarios passing
- [ ] WebSocket events documented in API guide

**Phase 2** (Week 4 - Dec 2):

- [ ] Hierarchical locking (multiple tabs, independent locks)
- [ ] Tab lock limits enforced (if decided)
- [ ] Admin takeover (if decided)
- [ ] 4 additional BDD scenarios passing
- [ ] UI Team unblocked for Lock Status UI

---

**Meeting Duration**: 60 minutes  
**Decision Time**: 30 minutes (8 decisions √ó 2-3 min each)  
**Buffer**: 30 minutes (discussion, clarifications, edge cases)

**Bring**: Laptop (show `BE-001.3-DECISION-CHECKLIST.md` for details)

---

**Document Version**: 1.0.0  
**Last Updated**: November 16, 2025  
**Status**: üìã Ready for Monday Meeting
